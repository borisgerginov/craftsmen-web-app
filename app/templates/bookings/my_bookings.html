{% extends "base.html" %}
{% block title %}My Bookings{% endblock %}
{% block content %}
    <h1>My bookings</h1>

    {% if current_user.is_authenticated and current_user.role == "provider" %}
        <div style="display:flex; gap:12px; margin: 12px 0;">
            <a href="{{ url_for('provider_bookings.incoming') }}">üì• Incoming bookings</a>
            <a href="{{ url_for('provider_bookings.schedule') }}">üóìÔ∏è My schedule</a>
        </div>
    {% endif %}

    {% if not items %}
        <p>–ù—è–º–∞—à –∑–∞—è–≤–∫–∏.</p>
    {% else %}
        <table>
            <thread>
                <tr>
                    <th>ID</th>
                    <th>–£—Å–ª—É–≥–∞</th>
                    <th>–ö–æ–≥–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thread>
            <tbody>
                {% for b in items %}
                    <tr>
                        <td>{{ b.id }}</td>
                        <td>{{ b.service.title if b.service else b.service_id }}</td>
                        <td>{{ b.scheduled_at }}</td>
                        <td>{{ b.status }}</td>
                        <td>
                            {% if b.status in ["pending", "accepted"] %}
                                <form method="post" action="{{ url_for('bookings.cancel_booking', booking_id=b.id)}}" style="display:inline">
                                    <button type="submit">Cancel</button>
                                </form>
                            {% endif %}

                            {% if b.status in ["accepted", "completed"] %}
                                <form method="post" action="{{ url_for('payments.pay_booking', booking_id=b.id) }}" style="display:inline;">
                                    <button type="submit">Pay</button>
                                </form>
                            {% endif %}

                            {% if b.status == "completed" %}
                                <a href="{{ url_for('reviews.add_review', booking_id=b.id) }}">Leave review</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}